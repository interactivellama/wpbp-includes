/*
*  Repeater
*
*  @description: 
*  @since: 3.5.8
*  @created: 17/01/13
*/(function(e){acf.fields.repeater={update_order:function(){},set_column_widths:function(){},add_sortable:function(){},update_classes:function(){},add_row:function(){},remove_row:function(){},text:{min:"Minimum rows reached ( {min} rows )",max:"Maximum rows reached ( {max} rows )"}};var t=acf.fields.repeater;t.update_order=function(t){t.find("> table > tbody > tr.row").each(function(t){e(this).children("td.order").html(t+1)})};t.set_column_widths=function(t){if(t.children(".acf-input-table").hasClass("row_layout"))return;var n=100;t.find("> .acf-input-table > thead > tr > th.order").exists()&&(n=93);t.find("> .acf-input-table  > thead > tr > th[width]").each(function(t){n-=parseInt(e(this).attr("width"))});var r=t.find("> .acf-input-table > thead > tr > th").not("[width]").has("span");if(r.length>1){n/=r.length;r.each(function(t){if(t+1==r.length)return;e(this).attr("width",n+"%")})}};t.add_sortable=function(n){var r=parseFloat(n.attr("data-max_rows"));if(r<=1)return;n.find("> table > tbody").unbind("sortable").sortable({items:"> tr.row",handle:"> td.order",helper:acf.helpers.sortable,forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(t,n){e(document).trigger("acf/sortable_start",n.item);e(document).trigger("acf/sortable_start_repeater",n.item);var r=n.item.children("td").length;n.placeholder.html('<td colspan="'+r+'"></td>')},stop:function(r,i){e(document).trigger("acf/sortable_stop",i.item);e(document).trigger("acf/sortable_stop_repeater",i.item);t.update_order(n)}})};t.update_classes=function(e){var t=parseFloat(e.attr("data-max_rows")),n=e.find("> table > tbody > tr.row").length;n==0?e.addClass("empty"):e.removeClass("empty");if(n>=t){e.addClass("disabled");e.find("> .repeater-footer .acf-button").addClass("disabled")}else{e.removeClass("disabled");e.find("> .repeater-footer .acf-button").removeClass("disabled")}};e(document).live("acf/setup_fields",function(n,r){e(r).find(".repeater").each(function(){var n=e(this);t.set_column_widths(n);t.update_classes(n);t.add_sortable(n)})});t.add_row=function(n,r){var i=parseInt(n.attr("data-max_rows")),s=n.find("> table > tbody > tr.row").length;if(s>=i){alert(t.text.max.replace("{max}",i));return!1}var o=acf.helpers.uniqid(),u=n.find("> table > tbody > tr.row-clone").html().replace(/(=["]*[\w-\[\]]*?)(acfcloneindex)/g,"$1"+o),a=e('<tr class="row"></tr>').append(u);r||(r=n.find("> table > tbody > .row-clone"));r.before(a);n.closest("tr").trigger("mouseenter");t.update_order(n);t.update_classes(n);e(document).trigger("acf/setup_fields",a);n.closest(".field").removeClass("error")};e(".repeater .repeater-footer .add-row-end").live("click",function(){var n=e(this).closest(".repeater");t.add_row(n,!1);return!1});e(".repeater td.remove .add-row-before").live("click",function(){var n=e(this).closest(".repeater"),r=e(this).closest("tr");t.add_row(n,r);return!1});t.remove_row=function(e){var n=e.closest(".repeater"),r=parseInt(n.attr("data-min_rows")),i=n.find("> table > tbody > tr.row").length,s=e.children("tr.row").length,o=e.height();if(i<=r){alert(t.text.min.replace("{min}",i));return!1}e.addClass("acf-remove-item");setTimeout(function(){e.remove();n.closest("tr").trigger("mouseenter");t.update_order(n);t.update_classes(n)},400)};e(".repeater td.remove .acf-button-remove").live("click",function(){var n=e(this).closest("tr");t.remove_row(n);return!1});e(".repeater tr").live("mouseenter",function(){var t=e(this).find("> td.remove > a.acf-button-add"),n=t.parent().height()/2+9;t.css("margin-top","-"+n+"px")})})(jQuery);